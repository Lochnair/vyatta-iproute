#!/usr/bin/make -f

# created by Andreas Barth <aba@not.so.argh.org> 2004

build: build-arch

clean:
	-rm stamp-build
	dh_testdir
	dh_testroot
	dh_clean
	make distclean

binary: binary-arch

binary-arch: build-arch include/SNAPSHOT.h
	rm -f debian/files
	dh_testdir
	dh_testroot
	dh_install -a --fail-missing
	dh_link -a
	dh_installman -a
	dh_installdocs -a
	dh_installchangelogs -a
	dh_compress -a
	dh_strip -a
	dh_fixperms -a
	dh_installdeb -a
	dh_shlibdeps -a -Xq_atm.so
	if [ -f "../.VYATTA_DEV_BUILD" ]; then \
		dh_gencontrol -a -- -v999.dev; \
	else \
		dh_gencontrol -a; \
	fi
	dh_md5sums -a
	dh_builddeb -a

build-arch: stamp-build
stamp-build: include/SNAPSHOT.h
	$(MAKE) KERNEL_INCLUDE=./include
	touch stamp-build

include/SNAPSHOT.h:
	echo SNAPSHOT!!!!
	echo "#define VERSION \"vyatta-"`date +%y%m%d`"\"" > include/SNAPSHOT.h

.PHONY: build binary binary-arch clean

